<title>Configuration</title>

<div class="container">
  <div class="card custom-card">
    <div class="card-header text-center">
      <h4>Streaming Configuration</h4>
    </div>
    <div class="card-body">
      <%= form_with(model: streaming_configuration, local: true) do |form| %>
        <div class="form-group">
          <%= form.label :server_ip, "Server IP", class: "form-label" %>
          <%= form.text_field :server_ip, value: streaming_configuration.server_ip || '192.168.1.253', class: "form-control", placeholder: "Enter server IP", required: true %>
        </div>

        <div class="form-group">
          <%= form.label :port, "Port", class: "form-label" %>
          <%= form.number_field :port, value: streaming_configuration.port || 8080, class: "form-control", placeholder: "Enter port", required: true %>
        </div>

        <div class="form-group">
          <%= form.label :server_name, "Name", class: "form-label" %>
          <%= form.text_field :server_name, value: streaming_configuration.server_name || 'SoftexTv', class: "form-control", placeholder: "Enter server name", required: true %>
        </div>
        <div class="form-group">
          <%= form.label :widgets, "Enable Widgets", class: "form-label" %>
          <%= form.check_box :widgets, id: 'streaming-checkbox', data: { id: @streaming_configuration.id } %>
        </div>

        <div class="form-footer">
          <%= form.submit "Save", class: "btn btn-primary btn-block" %>
        </div>
      <% end %>
    </div>

    <div class="card-footer text-center">
      <%= link_to "Back", broadcasts_path, class: "btn btn-secondary btn-sm" %>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const checkbox = document.querySelector('#streaming-checkbox');
    if (checkbox) {
      checkbox.addEventListener('change', async (e) => {
        const isChecked = e.target.checked;
        const url = isChecked ? '/video/start' : '/video/stop';  // URL of the controller that will control the process
        const method = 'POST';
        const csrfToken = document.querySelector("meta[name='csrf-token']").content;

        const command = isChecked ? 'start' : 'stop';  // Defining the command

        try {
          const response = await fetch(url, {
            method: method,
            headers: {
              'Content-Type': 'application/json',
              'X-CSRF-Token': csrfToken
            },
            body: JSON.stringify({ video: { command: command } })  // Sending the command in the body
          });
          const result = await response.json();
          if (response.ok) {
            alert(result.message);  // Displaying the success response
          } else {
            alert(`Error: ${result.error}`);
          }
        } catch (error) {
          console.error('Error in request:', error);
        }
      });
    }
  });
</script>

<style>
  h1 {
      text-align: center;
      color: #ffffff;
      top: 0;
      position: absolute;
      width: -webkit-fill-available;
      background-color: #ae5f22;
      padding: 27px;
      margin: 0;
  }
  /* Global Style */
  body {
    font-family: Arial, sans-serif;
    background-color: #f4f7fc;
    color: #333;
    margin: 0;
    padding: 0;
  }

  .container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 20px;
  }

  .card {
    width: 100%;
    max-width: 500px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    background-color: #fff;
    padding: 20px;
  }

  .card-header {
    background-color: #007bff;
    color: white;
    padding: 20px;
    border-radius: 10px 10px 0 0;
  }

  .card-footer {
      display: flex;
      justify-content: center;
      padding: 10px 20px;
      border-top: 1px solid #ddd;
      border-radius: 0 0 10px 10px;
  }

  .card-footer .btn {
    width: 48%;
    text-align: center;
  }

  .form-group {
    margin-bottom: 20px;
  }

  .form-label {
    font-weight: bold;
    color: #333;
  }

  .form-control {
    border-radius: 8px;
    padding: 10px;
    border: 1px solid #ddd;
    width: 100%;
    box-sizing: border-box;
  }

  .form-control:focus {
    border-color: #007bff;
    outline: none;
    box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
  }

  .form-footer {
    margin-top: 20px;
  }

  .btn {
    border-radius: 30px;
    padding: 10px;
    font-size: 16px;
  }

  .btn-primary {
    background-color: #007bff;
    border-color: #007bff;
  }

  .btn-primary:hover {
    background-color: #0056b3;
  }

  .btn-secondary {
    background-color: #6c757d;
    border-color: #6c757d;
  }

  .btn-info {
    background-color: #17a2b8;
    border-color: #17a2b8;
  }

  .btn-block {
    width: 100%;
  }
</style>